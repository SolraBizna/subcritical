--[[
  This source file is part of the SubCritical distribution.
  Copyright (C) 2008 Solra Bizna.

  SubCritical is free software: you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as
  published by the Free Software Foundation, either version 2 of the
  License, or (at your option) any later version.

  SubCritical is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Lesser General Public License for more details.

  You should have received a copy of both the GNU General Public
  License and the GNU Lesser General Public License along with
  SubCritical.  If not, see <http://www.gnu.org/licenses/>.

  Please see doc/license.html for clarifications.
]]

require "scui"
require "liberation"

uranium = {}
uranium.font = TTF.Liberation.Sans[12]
uranium.bfont = TTF.Liberation.Sans.Bold[12]

function uranium.DrawBox(x, y, w, h)
   if(screen.DrawBox) then return screen:DrawBox(x, y, w, h)
   else
      screen:DrawRect(x, y, w, 1)
      screen:DrawRect(x, y+h-1, w, 1)
      screen:DrawRect(x, y+1, 1, h-2)
      screen:DrawRect(x+w-1, y+1, 1, h-2)
   end
end

dofile(P"box.lua")
dofile(P"text.lua")
dofile(P"button.lua")
dofile(P"field.lua")
dofile(P"cursor.lua")

function uranium.Alert(text, default_button, cancel_button, other_button)
   if(default_button == true) then default_button = "OK" end
   if(cancel_button == true) then cancel_button = "Cancel" end
   if(other_button == true) then other_button = "Abort" end
   local alert = {
      w=315,
      type=uranium.box, filled=true,
      {x=20,y=15,w=260,type=uranium.text,text=text},
   }
   uranium.text.SetupText(alert[1])
   local buttony = alert[1].h + alert[1].y + 10
   alert.h = buttony + 35
   alert[#alert+1] = {x=210,y=buttony,w=85,h=20,type=uranium.button,hotkeys={["return"]=true},text=default_button or "OK",tag=1}
   if(cancel_button) then
      alert[#alert+1] = {x=115,y=buttony,w=85,h=20,type=uranium.button,hotkeys={["escape"]=true},text=cancel_button,tag=2}
   end
   if(other_button) then
      alert[#alert+1] = {x=20,y=buttony,w=85,h=20,type=uranium.button,hotkeys={["backspace"]=true,["delete"]=true},text=other_button,tag=3}
   end
   local sw,sh = screen:GetSize()
   assert(sw >= alert.w, "Alert too wide for screen! (screen should be >320 pixels wide)")
   alert.x = math.floor((sw-alert.w)/2)
   if(sh <= alert.h) then
      alert.y = sh - alert.h
   else
      alert.y = math.floor((sh-alert.h)*2/5)
   end
   scui.CompileWidget(alert)
   return scui.RunModal(alert, nil, uranium.cursor())
end
